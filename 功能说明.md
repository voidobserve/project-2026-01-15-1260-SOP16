# 项目功能说明

## 项目概述

这是一个基于TX8C126x微控制器的智能照明控制系统，具有多种调光方式（旋钮调光、RF遥控）、温度监测、风扇控制等功能。系统通过PWM输出控制灯具亮度，具备安全保护机制。

## 主要功能

### 1. PWM调光控制
- 支持双路PWM输出（P14/P16和P15/P05），分别控制两路灯源
- 具备开机软启动功能，渐进式调节PWM占空比避免电流冲击
- 支持旋钮调光和RF遥控调光两种方式

### 2. 温度监测与保护
- 实时监测热敏电阻电压值，转换为温度信息
- 当温度超过75°C并持续5分钟时，自动降低PWM占空比进行保护
- 温度恢复正常后自动恢复亮度

### 3. 风扇控制与监测
- 监测风扇工作状态，当检测到风扇故障时自动降低PWM输出
- 风扇异常时，PWM占空比降至25%保护设备
- 延时判断机制，防止误判

### 4. RF遥控功能
- 支持433MHz无线遥控操作
- 可远程控制开关和亮度调节
- 兼容有线和无线双模式

### 5. 发动机功率稳定性检测
- 监测外部电源或发电机的功率稳定性
- 当检测到功率不足时，自动调节PWM输出
- 防止因电源不稳导致的设备损坏

### 6. 安全保护机制
- 开机缓启动，避免浪涌电流
- 多重限流保护机制
- 看门狗监控程序运行状态

## 主要函数功能说明

### 1. [main](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/main.c#L165-L303)
系统主函数，初始化各模块并进入主循环执行各项功能

### 2. [system_init](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/Libraries/Source/system.c#L40-L112)
系统初始化函数，配置时钟、GPIO等基本参数

### 3. [pwm_init](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/pwm.c#L30-L76)
PWM模块初始化，配置双路PWM输出

### 4. [set_pwm_channel_0_duty](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/pwm.c#L110-L117) 和 [set_pwm_channel_1_duty](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/pwm.c#L119-L126)
分别设置两路PWM输出的占空比

### 5. [adjust_pwm_duty_when_power_on](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/main.c#L85-L109)
实现开机软启动功能，逐步增加PWM占空比

### 6. [update_max_pwm_duty_coefficient](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/knob_dimming.c#L148-L218)
根据旋钮位置更新最大允许的PWM占空比

### 7. [temperature_scan](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/adc.c#L242-L279)
扫描热敏电阻电压值，判断温度状态并实施相应保护措施

### 8. [fan_scan](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/fan_ctl.c#L138-L184)
检测风扇工作状态，异常时限制PWM输出

### 9. [fan_ctl](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/fan_ctl.c#L195-L239)
控制风扇开关

### 10. [rf_recv_init](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/rf_recv.c#L32-L40) 和 [rf_key_handle](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/rf_recv.c#L123-L166)
RF遥控功能初始化及按键处理

### 11. [adc_config](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/adc.c#L30-L129)
ADC模块初始化，配置多个通道用于检测不同传感器输入

### 12. [tmr0_config](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/time0.c#L29-L66)、[tmr1_config](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/timer1.c#L28-L60)、[timer2_config](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/timer2.c#L28-L60)、[timer3_config](file:///d:/A_WorkSt/Aworkst/99-%E4%BB%A5%E5%BE%80%E9%A1%B9%E7%9B%AE/B--%E5%8C%97%E9%99%80/code/BT-101/project-2026-01-15-1260-SOP16/User/timer3.c#L29-L128)
定时器配置函数，提供精确的时序控制和PWM调节

## 引脚分配

| 引脚 | 功能 |
|------|------|
| P13 | 检测风扇工作状态是否异常 |
| P12 | 控制风扇开关 |
| P11 | RF-433功能使能脚 |
| P00 | DEBUG打印引脚 |
| P03 | RF-433信号接收脚 |
| P31 | 检测旋钮调光 |
| P30 | 检测热敏电阻一侧的电压（温度检测引脚） |
| P27 | 检测发动机是否稳定 |
| P16 | 一路PWM输出，控制一路灯光 |
| P15 | 一路PWM输出，控制一路灯光 |
| P14 | 固定输出低电平 |

## 技术特点

- 采用多级保护机制确保设备安全运行
- 支持软启动避免电流冲击
- 实现多种调光方式兼容
- 具备自动温度调节和风扇控制功能
- 集成RF遥控功能扩展应用范围